# mise configuration for 3focus project
# https://mise.jdx.dev/configuration.html

[tools]
node = "22.11.0"
go = "1.23"

[env]
GO_ENV = "development"
VITE_API_URL = "http://localhost:8080"

# Task definitions
# Run with: mise run <task-name>
# List all tasks: mise tasks

[tasks.up]
description = "Start all containers"
run = "docker-compose up -d"

[tasks.down]
description = "Stop all containers"
run = "docker-compose down"

[tasks.dev]
description = "Start development environment (foreground)"
run = "docker-compose up"

[tasks.build]
description = "Build all containers"
run = "docker-compose build"

[tasks.rebuild]
description = "Rebuild and restart all containers"
run = "docker-compose down && docker-compose build && docker-compose up -d"

[tasks.restart]
description = "Restart all containers"
run = "docker-compose restart"

[tasks.logs]
description = "Show logs from all containers"
run = "docker-compose logs -f"

[tasks."logs:backend"]
description = "Show backend logs"
run = "docker-compose logs -f backend"

[tasks."logs:frontend"]
description = "Show frontend logs"
run = "docker-compose logs -f frontend"

[tasks."logs:db"]
description = "Show database logs"
run = "docker-compose logs -f db"

[tasks.clean]
description = "Stop containers and remove volumes"
run = """
docker-compose down -v
rm -rf backend/tmp
rm -rf frontend/node_modules
rm -rf frontend/dist
"""

[tasks.stop]
description = "Stop all containers (alias for down)"
run = "docker-compose stop"

[tasks.ps]
description = "Show running containers"
run = "docker-compose ps"

# Database tasks
[tasks."db:init"]
description = "Initialize database with schema"
run = """
docker-compose exec -T db psql -U 3focus -d 3focus_db < database/schema.sql
echo "Database schema initialized successfully"
"""

[tasks."db:reset"]
description = "Reset database and reinitialize schema"
run = """
docker-compose exec -T db psql -U 3focus -d 3focus_db -c "DROP SCHEMA public CASCADE; CREATE SCHEMA public;"
docker-compose exec -T db psql -U 3focus -d 3focus_db < database/schema.sql
echo "Database reset and schema reinitialized"
"""

[tasks."db:shell"]
description = "Open PostgreSQL shell"
run = "docker-compose exec db psql -U 3focus -d 3focus_db"

[tasks."db:status"]
description = "Show database tables"
run = "docker-compose exec db psql -U 3focus -d 3focus_db -c '\\dt'"
